{% extends "base.html" %} {% block title %}{% if is_root %}Kenneth Reitz{% else
%}{{ path.name }}{% endif %}{% endblock %} {% block head %}
<style>
    /* Custom classes for programmer-focused directory view */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .directory-header {
        animation: fadeIn 0.8s ease;
    }

    .section-divider {
        position: relative;
    }

    .section-divider::before {
        content: "//";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--tw-bg-opacity, 1);
        background-color: rgb(
            var(--tw-bg-opacity) * 252 var(--tw-bg-opacity) * 250
                var(--tw-bg-opacity) * 245 / var(--tw-bg-opacity)
        );
        padding: 0 1rem;
        font-family: "JetBrains Mono", monospace;
        color: rgba(var(--color-syntax-comment), 0.8);
    }

    /* Tree view styles */
    .directory-tree {
        font-family: "JetBrains Mono", monospace;
        font-size: 0.9rem;
    }

    .tree-item {
        margin-bottom: 0.15rem;
    }

    .tree-toggle {
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        padding: 0.2rem;
        border-radius: 0.25rem;
        transition: background-color 0.2s;
    }

    .tree-toggle:hover {
        background-color: rgba(var(--color-accent), 0.1);
    }

    .tree-toggle .icon {
        width: 16px;
        height: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
    }

    .tree-toggle.collapsed .icon {
        transform: rotate(-90deg);
    }

    .tree-children {
        padding-left: 1.5rem;
        margin-top: 0.15rem;
        overflow: hidden;
        max-height: 1000px;
        transition: max-height 0.3s ease-in-out;
    }

    .tree-children.collapsed {
        max-height: 0;
    }

    .tree-folder-icon,
    .tree-file-icon {
        width: 16px;
        height: 16px;
        margin-right: 0.4rem;
        opacity: 0.7;
    }

    .directory-tabs {
        display: flex;
        border-bottom: 1px solid var(--color-border);
        margin-bottom: 1rem;
    }

    .tab {
        padding: 0.5rem 1rem;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.9rem;
    }

    .tab.active {
        border-bottom: 2px solid var(--color-primary);
        color: var(--color-primary);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }
</style>
{% endblock %} {% block content %}
<div class="directory-header mb-12 relative">
    <div
        class="flex flex-col text-sm mb-8 bg-background-code dark:bg-background-code-dark p-3 rounded-lg border border-border dark:border-border-dark font-mono"
    >
        <!-- Path navigator with accurate breadcrumbs -->
        <div class="flex items-center flex-wrap">
            <span
                class="mr-2 text-syntax-function dark:text-syntax-function opacity-90"
                >navigate:</span
            >
            {% if is_root %}
            <span
                class="flex items-center px-1 py-1 text-syntax-string dark:text-syntax-string font-medium"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mr-1 opacity-70"
                >
                    <path
                        d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    ></path>
                </svg>
                <span>root</span>
            </span>
            {% else %}
            <a
                href="/"
                class="text-link no-underline px-1 py-1 transition-colors hover:text-primary flex items-center"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mr-1 opacity-70"
                >
                    <path
                        d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    ></path>
                </svg>
                <span>root</span>
            </a>

            <!-- Only show accurate parts of the path -->
            {% set path_parts = request.path.strip('/').split('/') %} {% for i
            in range(path_parts|length - 1) %}
            <span class="text-syntax-operator dark:text-syntax-operator mx-1"
                >.</span
            >
            <a
                href="/{{ '/'.join(path_parts[:i+1]) }}"
                class="text-link no-underline px-1 py-1 transition-colors hover:text-primary flex items-center"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mr-1 text-syntax-number dark:text-syntax-number opacity-70"
                >
                    <path
                        d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
                    ></path>
                </svg>
                <span>{{ path_parts[i] }}</span>
            </a>
            {% endfor %}

            <!-- Current directory with no link -->
            <span class="text-syntax-operator dark:text-syntax-operator mx-1"
                >.</span
            >
            <span
                class="flex items-center px-1 py-1 text-syntax-number dark:text-syntax-number font-medium"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mr-1 opacity-70"
                >
                    <path
                        d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
                    ></path>
                </svg>
                <span>{{ path_parts[-1] }}</span>
            </span>
            {% endif %}
        </div>
    </div>

    {% if index %}
    <h1
        class="text-4xl mb-4 text-text dark:text-text-light relative inline-block after:content-[''] after:absolute after:bottom-[-10px] after:left-0 after:w-[60px] after:h-[3px] after:bg-gradient-to-r after:from-primary after:to-primary-light"
    >
        {{ index.title }}
    </h1>
    <div
        class="mb-10 text-text/80 dark:text-text-light/80 text-lg leading-relaxed max-w-prose"
    >
        {{ index.render() | safe }}
    </div>
    <div class="section-divider h-px bg-border dark:bg-border-dark my-12"></div>
    {% else %}
    <h1
        class="text-4xl mb-4 text-text dark:text-text-light relative inline-block after:content-[''] after:absolute after:bottom-[-10px] after:left-0 after:w-[60px] after:h-[3px] after:bg-gradient-to-r after:from-primary after:to-primary-light"
    >
        {% if is_root %}Kenneth Reitz{% else %}{{ path.name }}{% endif %}
    </h1>
    {% endif %}
</div>

{% if children or posts %}
<!-- Directory view tabs -->
<div class="directory-tabs mb-6">
    <div class="tab active" data-tab="grid">Grid View</div>
    <div class="tab" data-tab="tree">Tree View</div>
</div>

<!-- Grid view tab content -->
<div class="tab-content active" id="grid-view">
    {% if children %}
    <div class="mb-12">
        <h2
            class="text-xl mb-6 text-text dark:text-text-light relative inline-block border-b-0 pb-0 font-mono"
        >
            // directories
        </h2>
        <ul
            class="list-none p-0 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
        >
            {% for child in children %}
            <li
                class="directory-item mb-2 transition-all duration-300 rounded-lg border border-border dark:border-border-dark bg-white dark:bg-gray-900 shadow hover:shadow-md overflow-hidden hover:-translate-y-1 relative before:absolute before:top-0 before:left-0 before:w-1 before:h-full before:bg-accent before:opacity-0 hover:before:opacity-100 before:transition-opacity"
            >
                <a
                    href="{{ child.url }}"
                    class="flex items-center justify-between p-4 no-underline text-text dark:text-text-light h-full transition-colors hover:text-primary"
                >
                    <span>{{ child.title or child.name }}</span>
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-dir"
                        >/dir</span
                    >
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %} {% if posts %}
    <div class="mb-12">
        <h2
            class="text-xl mb-6 text-text dark:text-text-light relative inline-block border-b-0 pb-0 font-mono"
        >
            // files
        </h2>
        <ul
            class="list-none p-0 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
        >
            {% for post in posts %}
            <li
                class="directory-item mb-2 transition-all duration-300 rounded-lg border border-border dark:border-border-dark bg-white dark:bg-gray-900 shadow hover:shadow-md overflow-hidden hover:-translate-y-1 relative before:absolute before:top-0 before:left-0 before:w-1 before:h-full before:bg-accent before:opacity-0 hover:before:opacity-100 before:transition-opacity"
            >
                <a
                    href="{{ post.url }}"
                    class="flex items-center justify-between p-4 no-underline text-text dark:text-text-light h-full transition-colors hover:text-primary"
                >
                    <span>{{ post.title }}</span>
                    {% if post.slug.endswith('.md') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-md"
                        >.md</span
                    >
                    {% elif post.slug.endswith('.py') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-py"
                        >.py</span
                    >
                    {% elif post.slug.endswith('.js') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-js"
                        >.js</span
                    >
                    {% elif post.slug.endswith('.html') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-html"
                        >.html</span
                    >
                    {% elif post.slug.endswith('.css') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-css"
                        >.css</span
                    >
                    {% elif post.slug.endswith('.jpg') or
                    post.slug.endswith('.jpeg') or post.slug.endswith('.png') %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-img"
                        >.img</span
                    >
                    {% else %}
                    <span
                        class="text-xs px-2 py-1 rounded font-mono file-ext ext-txt"
                        >.file</span
                    >
                    {% endif %}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

<!-- Tree view tab content -->
<div class="tab-content" id="tree-view">
    <div
        class="directory-tree bg-background-code dark:bg-background-code-dark p-4 rounded-lg border border-border dark:border-border-dark mb-8"
    >
        <div id="tree-loading" class="text-center py-4">
            <svg
                class="animate-spin h-6 w-6 text-primary mx-auto"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
            >
                <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                ></circle>
                <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
            </svg>
            <p class="mt-2 text-text/60 dark:text-text-light/60">
                Loading directory tree...
            </p>
        </div>
        <div id="tree-root" class="hidden"></div>
    </div>
</div>

<!-- Tree view JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Tab switching
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => {
            tab.addEventListener("click", () => {
                const targetTab = tab.dataset.tab;

                // Update active tab
                tabs.forEach((t) => t.classList.remove("active"));
                tab.classList.add("active");

                // Show corresponding content
                tabContents.forEach((content) => {
                    content.classList.remove("active");
                    if (content.id === `${targetTab}-view`) {
                        content.classList.add("active");
                    }
                });

                // Lazy load tree view data when tab is activated
                if (
                    targetTab === "tree" &&
                    !document.querySelector("#tree-root").hasChildNodes()
                ) {
                    fetchDirectoryTree();
                }
            });
        });

        // Fetch directory tree data
        function fetchDirectoryTree() {
            const path = "{{ path }}";
            const treeRoot = document.getElementById("tree-root");
            const treeLoading = document.getElementById("tree-loading");

            fetch(`/api/tree?path=${path}`)
                .then((response) => response.json())
                .then((data) => {
                    // Remove loading indicator and show tree
                    treeLoading.classList.add("hidden");
                    treeRoot.classList.remove("hidden");

                    // Render the tree
                    if (data.tree && data.tree.length > 0) {
                        renderTree(data.tree, treeRoot);
                    } else {
                        treeRoot.innerHTML =
                            '<p class="text-center py-4 text-text/60 dark:text-text-light/60">No items found.</p>';
                    }

                    // Add event listeners for tree toggles
                    setupTreeToggles();
                })
                .catch((error) => {
                    console.error("Error fetching directory tree:", error);
                    treeLoading.classList.add("hidden");
                    treeRoot.classList.remove("hidden");
                    treeRoot.innerHTML = `<p class="text-center py-4 text-error">Error loading directory tree: ${error.message}</p>`;
                });
        }

        // Render tree structure
        function renderTree(items, container) {
            items.forEach((item) => {
                const itemEl = document.createElement("div");
                itemEl.className = "tree-item";

                if (item.is_dir && item.children && item.children.length > 0) {
                    // Directory with children
                    itemEl.innerHTML = `
                        <div class="tree-toggle">
                            <span class="icon">â–¼</span>
                            <svg class="tree-folder-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <a href="${item.url}" class="hover:text-primary">${item.title}</a>
                        </div>
                        <div class="tree-children"></div>
                    `;

                    container.appendChild(itemEl);
                    renderTree(
                        item.children,
                        itemEl.querySelector(".tree-children"),
                    );
                } else if (item.is_dir) {
                    // Empty directory
                    itemEl.innerHTML = `
                        <div class="pl-4 flex items-center">
                            <svg class="tree-folder-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <a href="${item.url}" class="hover:text-primary">${item.title}</a>
                        </div>
                    `;
                    container.appendChild(itemEl);
                } else {
                    // File
                    itemEl.innerHTML = `
                        <div class="pl-4 flex items-center">
                            <svg class="tree-file-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <a href="${item.url}" class="hover:text-primary">${item.title}</a>
                        </div>
                    `;
                    container.appendChild(itemEl);
                }
            });
        }

        // Setup tree toggle functionality
        function setupTreeToggles() {
            document.querySelectorAll(".tree-toggle").forEach((toggle) => {
                toggle.addEventListener("click", (event) => {
                    // Prevent default navigation if we're clicking the toggle itself
                    if (!event.target.tagName.toLowerCase() === "a") {
                        event.preventDefault();
                    }

                    // Prevent clicks on links from toggling
                    if (event.target.tagName.toLowerCase() === "a") {
                        return;
                    }

                    toggle.classList.toggle("collapsed");
                    const children = toggle.nextElementSibling;
                    children.classList.toggle("collapsed");
                });
            });
        }
    });
</script>
{% endif %} {% endblock %}
